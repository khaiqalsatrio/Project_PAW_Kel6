<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>List Data Customer</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
    />
    <style>
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
        background-color: whitesmoke;
      }
      .content {
        flex-grow: 1;
        background-color: silver;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
      }
      footer {
        background-color: #0d6efd;
        color: white;
        text-align: center;
        padding: 5px 0;
      }

      /* Button hover and active effects */
      .btn {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .btn:active {
        transform: translateY(2px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="container content">
      <h1 class="text-center" style="color: white">Detail Pesanan</h1>

      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>No Telepon</th>
              <th>Jenis Kamar</th>
              <th>Check-in</th>
              <th>Check-out</th>
              <th>Harga</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="customerList">
            <% customer.forEach((dataCustomer) => { %>
            <tr>
              <td><%= dataCustomer.nama %></td>
              <td><%= dataCustomer.email %></td>
              <td><%= dataCustomer.phone_number %></td>
              <td><%= dataCustomer.jenis_room %></td>
              <td><%= dataCustomer.check_in_date %></td>
              <td><%= dataCustomer.check_out_date %></td>
              <td><%= dataCustomer.harga %></td>
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2">
                  <button class="btn btn-sm btn-success editBtn w-100" data-id="<%= dataCustomer.id %>">Edit</button>
                  <button class="btn btn-sm btn-danger deleteBtn w-100" data-id="<%= dataCustomer.id %>">Cancel</button>
                </div>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% if (customer.length === 0) { %>
      <div class="alert alert-warning text-center" role="alert">Belum ada Pesanan.</div> <% } %>
    </div>

    <!-- Notifikasi Konfirmasi Penghapusan -->
    <div id="confirmDeleteModal" class="modal fade" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmDeleteModalLabel">Konfirmasi Penghapusan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Apakah Anda yakin ingin menghapus data ini?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tidak</button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Cancel Booking</button>                      
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <footer
      class="text-white text-center py-2 mt-5"
      style="background-color: rgb(35, 33, 33)"
    >
      <p class="mb-0">&copy; 2024 Hotel Murah. All rights reserved.</p>
    </footer>
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Berfungsi untuk memformat tanggal dalam format bahasa Indonesia
      function formatDate(date) {
        const months = [
          "Januari",
          "Februari",
          "Maret",
          "April",
          "Mei",
          "Juni",
          "Juli",
          "Agustus",
          "September",
          "Oktober",
          "November",
          "Desember",
        ];
        const d = new Date(date);
        const day = d.getDate().toString().padStart(2, "0");
        const month = months[d.getMonth()];
        const year = d.getFullYear();
        return `${day} ${month} ${year}`;
      }

      // Function untuk format tanggal dan harga //
      $(document).ready(function () {
        // Ulangi setiap baris dan format kolom tanggal //
        $("#customerList tr").each(function () {
          const checkInDate = $(this).find("td:nth-child(5)").text(); // Tanggal check-in //
          const checkOutDate = $(this).find("td:nth-child(6)").text(); // Tanggal check-out //
          $(this).find("td:nth-child(5)").text(formatDate(checkInDate));
          $(this).find("td:nth-child(6)").text(formatDate(checkOutDate));
        });
        // Ulangi setiap baris dan format kolom harga //
        $("#customerList tr").each(function () {
          const harga = $(this).find("td:nth-child(7)").text(); // Harga column //
          // Format the price and update the cell //
          const formattedHarga = formatRupiah(harga);
          $(this).find("td:nth-child(7)").text(formattedHarga);
        });
        let selectedCustomerId = null; // Variabel untuk menyimpan ID customer yang dipilih //
        // Function untuk tombol delete //
        $(document).ready(function () {
          let selectedCustomerId = null;
          // Event listener untuk tombol Delete
          $(".deleteBtn").on("click", function () {
            selectedCustomerId = $(this).data("id");
            $("#confirmDeleteModal").modal("show");
          });
          // Event listener untuk tombol Hapus di modal konfirmasi
          $("#confirmDeleteBtn").on("click", function () {
            if (selectedCustomerId) {
              $.ajax({
                url: "/dataCustomer/" + selectedCustomerId,
                type: "DELETE",
                success: function () {
                  $("#confirmDeleteModal").modal("hide");
                  location.reload();
                },
                error: function (xhr) {
                  console.error("Error deleting customer:", xhr.responseText);
                  alert("Terjadi kesalahan saat menghapus data.");
                },
              });
            }
          });
        });
      });
      let selectedCustomerId = null; // Untuk menyimpan ID customer yang akan diedit
      // Event listener untuk tombol Edit
      $(".editBtn").on("click", function () {
        selectedCustomerId = $(this).data("id"); // Ambil ID customer dari tombol
        // Ambil data dari baris tabel yang sesuai
        const row = $(this).closest("tr");
        const nama = row.find("td:nth-child(1)").text();
        const email = row.find("td:nth-child(2)").text();
        const phoneNumber = row.find("td:nth-child(3)").text();
        const jenisKamar = row.find("td:nth-child(4)").text();
        const checkIn = row.find("td:nth-child(5)").text();
        const checkOut = row.find("td:nth-child(6)").text();
        const harga = row.find("td:nth-child(7)").text();

        // Isi modal dengan data dari baris tabel
        $("#editNama").val(nama);
        $("#editEmail").val(email);
        $("#editPhoneNumber").val(phoneNumber);
        $("#editJenisKamar").val(jenisKamar);
        $("#editCheckIn").val(checkIn);
        $("#editCheckOut").val(checkOut);
        $("#editHarga").val(harga);
        // Tampilkan modal
        $("#editModal").modal("show");
      });

      // Event listener untuk tombol Simpan di modal
      $("#saveEditBtn").on("click", function () {
        const updatedData = {
          nama: $("#editNama").val(),
          email: $("#editEmail").val(),
          phone_number: $("#editPhoneNumber").val(),
          jenis_room: $("#editJenisKamar").val(),
          check_in_date: $("#editCheckIn").val(),
          check_out_date: $("#editCheckOut").val(),
          harga: $("#editHarga").val(),
        };

        // Kirim data ke server dengan AJAX
        $.ajax({
          url: "/dataCustomer/" + selectedCustomerId,
          type: "PUT",
          contentType: "application/json",
          data: JSON.stringify(updatedData),
          success: function () {
            // Tutup modal dan refresh halaman
            $("#editModal").modal("hide");
            location.reload();
          },
          error: function (xhr) {
            console.error("Error updating customer:", xhr.responseText);
            alert("Terjadi kesalahan saat menyimpan data.");
          },
        });
      });
      // Berfungsi untuk memformat harga ke dalam format Rupiah (misal Rp 1.500.000)
      function formatRupiah(number) {
        return "Rp " + number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }
    </script>
  </body>
</html>
